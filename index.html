<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RC PDF Portal</title>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>
body{
margin:0;font-family:Arial;
background:linear-gradient(270deg,red,blue,green,purple,cyan);
background-size:600% 600%;
animation:bg 12s infinite alternate;
display:flex;justify-content:center;align-items:center;min-height:100vh;
}
@keyframes bg{0%{background-position:0%}100%{background-position:100%}}

.card{background:#000c;color:white;padding:25px;border-radius:18px;width:92%;max-width:420px;text-align:center}
input,button{width:100%;padding:12px;margin-top:10px;border:none;border-radius:10px;font-size:16px}
button{background:#00ffd5;font-weight:bold;cursor:pointer}
.hidden{display:none}

#authBox{position:fixed;inset:0;background:rgba(0,0,0,.88);display:flex;align-items:center;justify-content:center}
.authCard{background:white;color:black;padding:28px;width:320px;border-radius:16px;text-align:center}
.authLinks{display:flex;justify-content:space-between;font-size:14px;color:#0a58ca;cursor:pointer}

#userBox{
position:fixed;top:12px;right:12px;
background:white;padding:6px 12px;border-radius:10px;
display:none;text-align:center;font-weight:bold
}
</style>
</head>

<body>

<!-- AUTH BOX -->
<div id="authBox">
<div class="authCard">

<h3 id="authTitle">Login</h3>

<input id="mobileField" placeholder="Mobile Number">
<input id="emailField" placeholder="Email" class="hidden">
<input id="passField" type="password" placeholder="Password">

<button onclick="authAction()">Login</button>

<div class="authLinks">
<span onclick="switchSignup()">Signup</span>
<span onclick="showForget()">Forget</span>
</div>

<!-- FORGET FLOW -->
<div id="forgetBox" class="hidden">
<input id="forgetEmail" placeholder="Registered Email">
<button onclick="sendOTP()">Send OTP</button>

<input id="otpInput" class="hidden" placeholder="Enter OTP">
<button id="verifyBtn" class="hidden" onclick="verifyOTP()">Verify OTP</button>

<input id="newPass" class="hidden" placeholder="New Password">
<button id="saveBtn" class="hidden" onclick="saveNewPass()">Save Password</button>
</div>

<p id="authMsg"></p>
</div>
</div>

<!-- USER -->
<div id="userBox">
<span id="profileText"></span><br>
<button onclick="logout()" style="background:red;color:white;padding:6px 12px;border:none;border-radius:8px">
Logout
</button>
</div>

<!-- MAIN RC PORTAL -->
<div class="card">

<div id="p1">
<h3>ðŸš— Enter Vehicle Number</h3>
<input id="vehicle" placeholder="BR-09-AB-1234">
<button onclick="goPay()">Continue</button>
</div>

<div id="p2" class="hidden">
<h3>Pay â‚¹120</h3>
<img width="220" src="https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=upi://pay?pa=bestinsurance@upi&pn=BestInsurance&am=120&cu=INR">
<input id="mobile" placeholder="Mobile Number">
<input type="file" id="proof">
<button onclick="submitPay()">Submit</button>
</div>

<div id="p3" class="hidden">
<h3>Payment Successful</h3>
<p>RC PDF will be sent soon</p>
</div>

</div>

<script>
emailjs.init("eRTexjroiPjM9miek");

let users = JSON.parse(localStorage.getItem("users")||"{}");
let otpCode="", resetMobile="";

function save(){localStorage.setItem("users",JSON.stringify(users))}

/* SIGNUP MODE */
function switchSignup(){
authTitle.innerText="Signup";
emailField.classList.remove("hidden");
}

/* LOGIN & SIGNUP */
function authAction(){
let m=mobileField.value.trim();
let e=emailField.value.trim();
let p=passField.value.trim();

if(authTitle.innerText==="Signup"){
 if(!m||!e||!p) return authMsg.innerText="Fill all fields";
 if(users[m]) return authMsg.innerText="Already registered";

 users[m]={email:e,password:p};
 save();
 authMsg.innerText="Signup successful. Login now.";
 authTitle.innerText="Login";
 emailField.classList.add("hidden");
 return;
}

if(!users[m]) return authMsg.innerText="User not found";
if(users[m].password!==p) return authMsg.innerText="Wrong password";

localStorage.setItem("loggedUser",m);
showUser();
authBox.style.display="none";
}

/* SHOW USER */
function showUser(){
let m=localStorage.getItem("loggedUser");
profileText.innerText="ðŸ‘¤ "+m;
userBox.style.display="block";
}

if(localStorage.getItem("loggedUser")){
showUser();
authBox.style.display="none";
}

/* FORGET PASSWORD (EMAIL OTP) */
function showForget(){
forgetBox.classList.remove("hidden");
}

function sendOTP(){
let email=forgetEmail.value.trim();
let found=false;

for(let m in users){
 if(users[m].email===email){
  found=true;
  resetMobile=m;
 }
}
if(!found) return alert("Email not registered");

otpCode=Math.floor(100000+Math.random()*900000)+"";

emailjs.send(
 "service_h04mrbw",
 "template_g84p4hi",
 { email: email, passcode: otpCode }
).then(()=>{
 alert("OTP sent successfully to email");
 otpInput.classList.remove("hidden");
 verifyBtn.classList.remove("hidden");
},(err)=>{
 alert("Email error: "+err.text);
});
}

function verifyOTP(){
if(otpInput.value!==otpCode) return alert("Wrong OTP");

newPass.classList.remove("hidden");
saveBtn.classList.remove("hidden");
}

function saveNewPass(){
users[resetMobile].password=newPass.value;
save();
alert("Password updated successfully");
forgetBox.classList.add("hidden");
}

/* LOGOUT */
function logout(){
localStorage.removeItem("loggedUser");
userBox.style.display="none";
authBox.style.display="flex";
}

/* RC FLOW */
function goPay(){
p1.classList.add("hidden");
p2.classList.remove("hidden");
}

function submitPay(){
p2.classList.add("hidden");
p3.classList.remove("hidden");
}
</script>

</body>
</html>